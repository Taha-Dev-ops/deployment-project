name: ğŸš€ Self-Hosted CI/CD Deployment

on:
  push:
    branches: [main]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v3

      - name: ğŸ” Security Scan
        run: |
          echo "ğŸ”’ Scanning code..."
          if find . -name "*.html" -exec grep -l "TODO\|FIXME" {} \; | grep -q .; then
            echo "âŒ TODO/FIXME comments found - Failing build"
            exit 1
          fi
          echo "âœ… Security checks passed"

  automated-deploy:
    runs-on: self-hosted
    needs: security-scan
    if: success()
    
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v3

      - name: ğŸš€ Auto Deploy
        run: |
          echo "âœ… Running on self-hosted runner!"
          cd /var/deployment-project
          git pull origin main
          sudo systemctl restart nginx
          echo "ğŸš€ Deployment completed successfully!"
          echo "ğŸŒ Website: http://localhost"
