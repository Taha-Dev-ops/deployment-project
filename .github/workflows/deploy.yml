name: 🚀 Self-Hosted CI/CD Deployment

on:
  push:
    branches: [main]

jobs:
  security-scan:
    runs-on: ubuntu-latest
    steps:
      - name: 📥 Checkout Code
        uses: actions/checkout@v3

      - name: 🔍 Security Scan
        run: |
          echo "🔒 Scanning code..."
          if find . -name "*.html" -exec grep -l "TODO\|FIXME" {} \; | grep -q .; then
            echo "❌ TODO/FIXME comments found - Failing build"
            exit 1
          fi
          echo "✅ Security checks passed"

  automated-deploy:
    runs-on: self-hosted
    needs: security-scan
    if: success()
    
    steps:
      - name: 📥 Checkout Code
        uses: actions/checkout@v3

      - name: 🚀 Auto Deploy
        run: |
          echo "✅ Running on self-hosted runner!"
          cd /var/deployment-project
          git pull origin main
          sudo systemctl restart nginx
          echo "🚀 Deployment completed successfully!"
          echo "🌐 Website: http://localhost"
